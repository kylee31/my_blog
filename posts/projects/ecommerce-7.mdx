---
title: ìƒí’ˆ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• ì €ì¥
date: 2024-07-18
description: ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•, Store ì €ì¥
cate: ecommerce
---

> ì§ˆë¬¸ì„ ì£¼ì…¨ê³  ë„ˆë¬´ ìì‹ ìˆë˜ ë‚´ìš©ì¸ë° í•´ë‹¹ ë‚´ìš©ì„ í¬íŠ¸í´ë¦¬ì˜¤ì—ë§Œ ì •ë¦¬í•´ë‘ê³  ë¸”ë¡œê·¸ì— ì˜®ê²¨ë‘ì§€ ì•Šì•„ì„œ ìì„¸í•œ ë‚´ìš©ì„
> ìŠê³  ìˆì—ˆë‹¤..ã…œã…œ ê·¸ëƒ¥ ë§!í–‡ë‹¹ ë‹¤ìŒ ë©´ì ‘ì´ë‚˜ ì—´ì‹¬íˆ ì¤€ë¹„í•˜ì..ğŸ˜‡

ğŸ‘©â€ğŸ’» ì´ì „ [React í™œìš© ì´ˆê¸° í”„ë¡œì íŠ¸](/projects/moviediary)ì—ì„œ localstorageì— ì €ì¥í•˜ë©´ì„œ ì´ë¯¸ì§€ ë¦¬ì†ŒìŠ¤ê°€ í° ë¹„ì¤‘ì„ ì°¨ì§€í•œë‹¤ëŠ”
ì‚¬ì‹¤ì„ ì²´ê°í•˜ì˜€ë‹¤.

âœ” ê´€ë ¨ ì •ë¦¬ê¸€ : [movie-diaryì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ìš©](/projects/moviediary/moviediary-1)

í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œëŠ” Canvas APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ì‹œ ê·¸ë¦¬ëŠ” ë¡œì§ìœ¼ë¡œ êµ¬í˜„. ì´í›„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬íŒ©í† ë§ ì§„í–‰.
(ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ ì´ìœ  : ì„±ëŠ¥ ìµœì í™”ì™€ ë¡œì§ ë‹¨ìˆœí™”ë¥¼ ìœ„í•´)

1. browser-image-compression (ìµœëŒ€ ìš©ëŸ‰ ì„¤ì •)
2. react-image-file-resizer (ìµœëŒ€ í¬ê¸° ì„¤ì •)

ë§ˆì°¬ê°€ì§€ë¡œ ìƒí’ˆ ë“±ë¡ ì‹œ ì´ë¯¸ì§€ë¥¼ ë¦¬ì‚¬ì´ì§•í•˜ì˜€ë‹¤. ë™ì¼í•œ ë”ë¯¸ ë°ì´í„°(ì´ë¯¸ì§€)ë¥¼ ë“±ë¡í•˜ì—¬ í…ŒìŠ¤íŠ¸ í•œ ê²°ê³¼ 54kbì—ì„œ 28kbë¡œ ì¤„ì¼ ìˆ˜ ìˆì—ˆë‹¤.
ì´ í”„ë¡œì íŠ¸ì—ì„œ ì´ë¯¸ì§€ë¥¼ ìš©ëŸ‰ìœ¼ë¡œ ê¸°ì¤€í•˜ì—¬ ì¤„ì¼ ê²½ìš°, í™”ì§ˆ ì°¨ì´ê°€ ë°œìƒí•  ê²ƒ ê°™ì•„ ë“±ë¡í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í’ˆì§ˆì„ ì¤„ì´ë„ë¡
ì„¤ì •í•˜ì˜€ë‹¤.

â–¶ ì¦‰ 1ë²ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìµœëŒ€ 30kbë¡œ ì„¤ì •í•˜ë©´ 100kb, 50kbëŠ” 30kbë¡œ ì¤„ì–´ë“ ë‹¤(ì •í™•íˆ 30kbëŠ” ì•„ë‹ˆê³ , ìµœëŒ€í•œ ê°€ê¹ê²Œ). ë‹¤ë¥´ê²Œ
2ë²ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìµœëŒ€ í¬ê¸°ë¡œ ì„¤ì •í•˜ë©´ í¬ê¸°ì— ë§ë„ë¡ ë„“ì´, ë†’ì´ê°€ ì¤„ì–´ë“œëŠ” ê²ƒ.

ìœ„ì™€ ê°™ì€ ì´ìœ ë¡œ 2ë²ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ íƒí•˜ì—¬ ìƒí’ˆ ì´ë¯¸ì§€ íƒœê·¸(image) ë„“ì´, ë†’ì´ì—ì„œ ì´ˆê³¼ëœë‹¤ë©´ ë¦¬ì‚¬ì´ì§•í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ì˜€ë‹¤.

```js
import imageCompression from "browser-image-compression";

const compressImage = async (file) => {
  const options = {
    maxSizeMB: 0.03, // ìµœëŒ€ í¬ê¸° (30KB)
    useWebWorker: true,
  };

  try {
    const compressedFile = await imageCompression(file, options);
    console.log("ì••ì¶•ëœ íŒŒì¼ í¬ê¸°:", compressedFile.size); // í¬ê¸° í™•ì¸
    return compressedFile;
  } catch (error) {
    console.error(error);
  }
};

...
```

```js
import Resizer from "react-image-file-resizer";

const resizeImage = (file) => {
  Resizer.imageFileResizer(
    file,
    maxWidth, // ìµœëŒ€ ë„ˆë¹„ (ex. 800)
    maxHeight, // ìµœëŒ€ ë†’ì´ (ex. 700)
    "JPEG", // í¬ë§·
    90, // í’ˆì§ˆ
    0, // íšŒì „
    (uri) => {
      console.log(uri);
      // ì¡°ì •ëœ ì´ë¯¸ì§€ ì²˜ë¦¬ (ì˜ˆ: ì—…ë¡œë“œ ë˜ëŠ” í‘œì‹œ)
    },
    "base64" // ì¶œë ¥ ìœ í˜•
  );
};

...
```

â–² 2ê°€ì§€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì œ

ì°¸ê³ ë¡œ, AWS í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë¦¬ì‚¬ì´ì§•ì´ ì•„ë‹Œ ì„œë²„ ì „ì†¡ ì‹œ ë¦¬ì‚¬ì´ì§•ì´ ê°€ëŠ¥í•œ ë°©ë²•ë„ ìˆë‹¤.
AWSì˜ lambdaë¥¼ í™œìš©í•˜ì—¬ ë¦¬ì‚¬ì´ì§• function ì‹¤í–‰ í›„, S3ì— ì ì¬í•  ìˆ˜ ìˆë‹¤ê³  ì•Œê³  ìˆë‹¤. (API Gateway)

í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•  ë•Œ AWS Lambdaë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬ì‚¬ì´ì§•í•˜ê³  S3 ë²„í‚·ì— ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì€ ì„œë²„ ì¸¡ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë¦¬ì‚¬ì´ì§•í•˜ì—¬ ìµœì¢…ì ìœ¼ë¡œ S3ì— ì €ì¥í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤.

1. Lambda í•¨ìˆ˜ ì‘ì„±
   Lambda í•¨ìˆ˜ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì „ì†¡ëœ ì´ë¯¸ì§€ë¥¼ ë¦¬ì‚¬ì´ì§•í•˜ê³  S3ì— ì €ì¥í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ë‹¤ìŒì€ Lambda í•¨ìˆ˜ì˜ ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤.

1.1. sharp ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
ë¨¼ì €, sharp ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë¦¬ì‚¬ì´ì§•í•©ë‹ˆë‹¤. ë¡œì»¬ì—ì„œ ì„¤ì¹˜í•œ í›„ zip íŒŒì¼ë¡œ ì—…ë¡œë“œí•©ë‹ˆë‹¤.

```bash
mkdir lambda-image-resize
cd lambda-image-resize
npm init -y
npm install sharp
```

1.2. Lambda í•¨ìˆ˜ ì½”ë“œ ì‘ì„±
index.js íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```js
const AWS = require("aws-sdk");
const S3 = new AWS.S3();
const sharp = require("sharp");

exports.handler = async (event) => {
  const { body, isBase64Encoded } = event;

  // base64ë¡œ ì¸ì½”ë”©ëœ ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ë””ì½”ë”©
  const imageBuffer = Buffer.from(body, isBase64Encoded ? "base64" : "binary");

  try {
    // ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•
    const resizedImage = await sharp(imageBuffer).resize(800, 800).toBuffer();

    const bucketName = "YOUR_BUCKET_NAME";
    const key = `resized/${Date.now()}.jpg`;

    // ë¦¬ì‚¬ì´ì§•ëœ ì´ë¯¸ì§€ S3ì— ì—…ë¡œë“œ
    await S3.putObject({
      Bucket: bucketName,
      Key: key,
      Body: resizedImage,
      ContentType: "image/jpeg",
    }).promise();

    return {
      statusCode: 200,
      body: JSON.stringify({ message: "Image resized and uploaded", key }),
    };
  } catch (err) {
    console.error(err);
    return {
      statusCode: 500,
      body: JSON.stringify(err),
    };
  }
};
```

2. Lambda í•¨ìˆ˜ ì„¤ì •
   AWS Lambda ì½˜ì†”ì—ì„œ ìƒˆ í•¨ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
   ìœ„ì˜ ì½”ë“œë¥¼ Lambda í•¨ìˆ˜ì— ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.
   sharp ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í¬í•¨í•œ zip íŒŒì¼ì„ Lambdaì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.

3. API Gateway ì„¤ì •
   API Gateway ì½˜ì†”ì—ì„œ ìƒˆ APIë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
   POST ë©”ì„œë“œë¥¼ ì¶”ê°€í•˜ê³ , Lambda í•¨ìˆ˜ì™€ í†µí•©í•©ë‹ˆë‹¤.
   Lambda í”„ë¡ì‹œ í†µí•©ì„ í™œì„±í™”í•©ë‹ˆë‹¤.

4. IAM ì—­í•  ì„¤ì •
   Lambda í•¨ìˆ˜ê°€ S3 ë²„í‚·ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ IAM ì—­í• ì— ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "logs:CreateLogGroup",
        "logs:CreateLogStream",
        "logs:PutLogEvents"
      ],
      "Resource": "*"
    },
    {
      "Effect": "Allow",
      "Action": ["s3:PutObject"],
      "Resource": "arn:aws:s3:::YOUR_BUCKET_NAME/*"
    }
  ]
}
```

5. í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ì‘ì„±
   í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” ì´ë¯¸ì§€ë¥¼ base64ë¡œ ì¸ì½”ë”©í•˜ì—¬ API Gatewayë¡œ ì „ì†¡í•©ë‹ˆë‹¤.

<br />

[ìš”ì•½]

1. í´ë¼ì´ì–¸íŠ¸ê°€ ì´ë¯¸ì§€ë¥¼ base64ë¡œ ì¸ì½”ë”©í•˜ì—¬ API Gatewayë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
2. API Gatewayê°€ Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
3. Lambda í•¨ìˆ˜ê°€ ì´ë¯¸ì§€ë¥¼ ë¦¬ì‚¬ì´ì§•í•˜ê³  S3 ë²„í‚·ì— ì €ì¥í•©ë‹ˆë‹¤.
